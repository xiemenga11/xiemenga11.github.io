<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>像素画板</title>
	<style>
		#can,#bg{
			display: block;
			width: 500px;
			height: 500px;
			border: 1px solid #eee;
			/*margin: 0 auto;*/
			position: absolute;
		}
		#box{
			width:500px;
			height:500px;
			margin: 0 auto;
		}
		#pannel{
			background-color: #ddd;
			padding: 10px;
			border-radius: 5px;
			margin-top: 10px;
			width: 800px;
			display: none;
		}
		#showPannel,#pannel,#clearBoard,#era,#saveImg,#colorBox{
			float: left;
		}
		#showPannel,#clearBoard,#era,#saveImg,#colorBox{
			background-color: #ddd;
			border-radius: 5px;
			padding:10px;
			margin: 10px;
			cursor: pointer;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}
		.greenShadow{
			box-shadow: 0 0 5px green;
		}
		#box{
			position: relative;
		}
		.clw{
			color:green;
		}
		.bor{
			border: 1px solid red;
		}
		.fo{
			font-size: 30px;
		}
		#colorBoard,#favorColor{
			position: fixed;
			top:0;
			border: 1px solid #eee;
			border-radius: 5px;
			padding:10px;
		}
		#colorBoard{
			left:0;
		}
		#favorColor{
			right:0;
		}
		.CB-color{
			font-size: 10px;
			padding:3px 5px;
			cursor: pointer;
		}
	</style>
</head>
<body>
<div id="box">
<canvas id="bg" width="500" height="500"></canvas>
<canvas id="can" width="500" height="500"></canvas>
</div>
<div id="colorBox">
	<label for="color">颜色：</label>
	<input type="color" id="color">
</div>
<div id="clearBoard">清除画板</div>
<div id="era" class="" data-role = 'leo'>橡皮擦</div>
<div id="saveImg">保存</div>

<!-- 色彩板 -->
<div id="colorBoard">
</div>
<!-- 保存的颜色 -->
<div id="favorColor">
</div>
<script src="../js/selector.js"></script>
<script src="../js/canvas.js"></script>
<script src="../js/leo.drag.js"></script>
<script>
	if(window.localStorage){
		alert('yes')
	}else{
		alert('no')
	}
	window.oncontextmenu = function(){

		// return false
		var d = document.createElement('div'),
			txt = document.createTextNode('alsdkf')
		d.style.backgroundColor = 'red'
		d.appendChild(txt)
		document.appendChild(d)
	}
	var can = C("can"),
		bg = C("bg"),
		wid = can.width,
		hei = can.height,
		blockColor = "black",
		era = false,
		blockSize = 10,
		colorBoard = l("#colorBoard"),
		favorColor = l("#favorColor")
	if(l.store.get('color')){
		var _color = l.store.get('color',1)
		for(var i = 0; i < _color.length; i++){
			addColorBtn(favorColor,_color[i])
		}
	}else{
		l.store.add('color',[])
	}

	//保存图片
	l("#saveImg").click(function(){
		window.open(can.makeFile())
	})
	//改变色块颜色
	l("#color").listen("change",function(){
		blockColor = l("#color").val()
		//向偏好颜色盒子添加颜色按键
		addColorBtn(colorBoard,blockColor)
		.listen('dblclick',function(){
			var _colorArr = l.store.get('color',1)
			_colorArr.push(blockColor)
			l.store.add('color',_colorArr)

			addColorBtn(favorColor,blockColor)
		})

	})
	function addColorBtn(box,color){
		return box.addElement('div')
		.addClass('CB-color')
		.css({backgroundColor:color})
		.html(color)
		.click(function(){
			blockColor = l(this).html()
		})
	}
	//重围画板
	l("#clearBoard").click(function(){
		initBoard()
	})
	//橡皮擦
	l("#era").click(function(){
		if(era){
			l(this).attr({className:""})
		}else{
			l(this).attr({className:"greenShadow"})
		}
		era = !era
	})
	//键盘控制橡皮擦
	l().listen('keydown',function(e){
		var e = e || event
		if(e.keyCode == 69){
			if(era){
				l('#era').attr({className:""})
			}else{
				l('#era').attr({className:"greenShadow"})
			}
			era = !era
		}
	})
	function erase(s){
		can.clear({
			start:s,
			size:[blockSize,blockSize]
		})
	}
	//初始化画板
	function drawLine(s,e){
		bg
		.save()
		.setSClo("#eee")
		.begin()
		.moveTo(s[0],s[1])
		.lineTo(e[0],e[1])
		.stroke()
		.close()
		.init()
	}
	function initBoard(){
		can.clearAll()
		bg.clearAll()
		var _line = Math.ceil(wid / blockSize)
		for(var i = 1; i < _line; i++){
			drawLine([i * blockSize, 0],[i * blockSize, hei])
			drawLine([0, i * blockSize],[wid, i * blockSize])
		}
	}
	function drawBlock(s){
		can
		.save()
		.begin()
		.setFClo(blockColor)
		.frec({
			start:s,
			size:[blockSize,blockSize]
		})
		.close()
		.init()
	}
	function draw(e){
		_x = Math.floor(e.offsetX / blockSize)*blockSize,
		_y = Math.floor(e.offsetY / blockSize)*blockSize
		if(!era){
			drawBlock([_x,_y])
		}else{
			erase([_x,_y])
		}
	}
	function moveDraw(e){
		var e = e || event
		draw(e)
	}
	initBoard()
	l("#can").click(function(e){
		var e = e || event
		draw(e)		
	}).listen("mousedown",function(){
		l(this).listen("mousemove",moveDraw)
	}).listen("mouseup",function(){
		l(this).unListen("mousemove",moveDraw)
	})
var num = [
	[
		[0,1,1,1,0],
		[1,0,0,0,1],
		[1,0,0,0,1],
		[1,0,0,0,1],
		[1,0,0,0,1],
		[0,1,1,1,0]
	],
	[
		[0,0,1,0,0],
		[0,1,1,0,0],
		[1,0,1,0,0],
		[0,0,1,0,0],
		[0,0,1,0,0],
		[1,1,1,1,1]
	],
	[
		[0,1,1,1,0],
		[1,0,0,0,1],
		[0,0,0,1,0],
		[0,0,1,0,0],
		[0,1,0,0,0],
		[1,1,1,1,1]
	]
]
function drawNum(n){
	for(var i = 0; i < num[n].length; i++){
		for(var j = 0; j < num[n][i].length; j++){
			if(num[n][i][j]){
				drawBlock([j*blockSize,i*blockSize])
			}
		}
	}
}

</script>
</body>
</html>